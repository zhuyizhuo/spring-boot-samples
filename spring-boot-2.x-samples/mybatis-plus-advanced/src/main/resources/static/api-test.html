<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBatis-Plus Advanced API 测试页面</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
        }
        .card {
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-3px);
        }
        .card-header {
            background-color: #007bff;
            color: white;
            border-radius: 8px 8px 0 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .btn-primary {
            background-color: #007bff;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .result-area {
            min-height: 150px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', Courier, monospace;
        }
        .api-section {
            margin-bottom: 30px;
        }
        .section-title {
            margin-bottom: 20px;
            color: #495057;
            font-weight: 600;
        }
        .dashboard {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        #userChart {
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="text-center mb-5">
            <h1 class="text-primary">MyBatis-Plus Advanced API 测试平台</h1>
            <p class="text-muted">使用此页面测试 MyBatis-Plus Advanced 项目的所有 RESTful API</p>
        </div>

        <!-- 数据概览面板 -->
        <div class="dashboard">
            <h3 class="section-title">数据概览</h3>
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center" style="border-color: #007bff;">
                        <div class="card-body">
                            <h5 class="card-title text-muted">总用户数</h5>
                            <p class="card-text display-4 text-primary" id="totalUsers">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center" style="border-color: #28a745;">
                        <div class="card-body">
                            <h5 class="card-title text-muted">平均年龄</h5>
                            <p class="card-text display-4 text-success" id="avgAge">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center" style="border-color: #dc3545;">
                        <div class="card-body">
                            <h5 class="card-title text-muted">活跃用户</h5>
                            <p class="card-text display-4 text-danger" id="activeUsers">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center" style="border-color: #ffc107;">
                        <div class="card-body">
                            <h5 class="card-title text-muted">删除用户</h5>
                            <p class="card-text display-4 text-warning" id="deletedUsers">0</p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="userChart"></div>
        </div>

        <!-- 获取所有用户 -->
        <div class="api-section">
            <h3 class="section-title">获取所有用户</h3>
            <div class="card">
                <div class="card-header">
                    GET /api/users
                </div>
                <div class="card-body">
                    <button id="getAllUsersBtn" class="btn btn-primary mb-3">获取所有用户</button>
                    <div class="result-area" id="allUsersResult"></div>
                </div>
            </div>
        </div>

        <!-- 根据ID获取用户 -->
        <div class="api-section">
            <h3 class="section-title">根据ID获取用户</h3>
            <div class="card">
                <div class="card-header">
                    GET /api/users/{id}
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="userId">用户ID:</label>
                        <input type="number" class="form-control" id="userId" placeholder="输入用户ID">
                    </div>
                    <button id="getUserByIdBtn" class="btn btn-primary mb-3">获取用户信息</button>
                    <div class="result-area" id="userByIdResult"></div>
                </div>
            </div>
        </div>

        <!-- 创建新用户 -->
        <div class="api-section">
            <h3 class="section-title">创建新用户</h3>
            <div class="card">
                <div class="card-header">
                    POST /api/users
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="createName">姓名:</label>
                        <input type="text" class="form-control" id="createName" placeholder="输入姓名">
                    </div>
                    <div class="form-group">
                        <label for="createAge">年龄:</label>
                        <input type="number" class="form-control" id="createAge" placeholder="输入年龄">
                    </div>
                    <div class="form-group">
                        <label for="createEmail">邮箱:</label>
                        <input type="email" class="form-control" id="createEmail" placeholder="输入邮箱">
                    </div>
                    <button id="createUserBtn" class="btn btn-primary mb-3">创建用户</button>
                    <div class="result-area" id="createUserResult"></div>
                </div>
            </div>
        </div>

        <!-- 更新用户信息 -->
        <div class="api-section">
            <h3 class="section-title">更新用户信息</h3>
            <div class="card">
                <div class="card-header">
                    PUT /api/users/{id}
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="updateId">用户ID:</label>
                        <input type="number" class="form-control" id="updateId" placeholder="输入用户ID">
                    </div>
                    <div class="form-group">
                        <label for="updateName">姓名:</label>
                        <input type="text" class="form-control" id="updateName" placeholder="输入新姓名">
                    </div>
                    <div class="form-group">
                        <label for="updateAge">年龄:</label>
                        <input type="number" class="form-control" id="updateAge" placeholder="输入新年龄">
                    </div>
                    <div class="form-group">
                        <label for="updateEmail">邮箱:</label>
                        <input type="email" class="form-control" id="updateEmail" placeholder="输入新邮箱">
                    </div>
                    <button id="updateUserBtn" class="btn btn-primary mb-3">更新用户</button>
                    <div class="result-area" id="updateUserResult"></div>
                </div>
            </div>
        </div>

        <!-- 删除用户 -->
        <div class="api-section">
            <h3 class="section-title">删除用户</h3>
            <div class="card">
                <div class="card-header">
                    DELETE /api/users/{id}
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="deleteId">用户ID:</label>
                        <input type="number" class="form-control" id="deleteId" placeholder="输入用户ID">
                    </div>
                    <button id="deleteUserBtn" class="btn btn-danger mb-3">删除用户</button>
                    <div class="result-area" id="deleteUserResult"></div>
                </div>
            </div>
        </div>

        <!-- 分页查询 -->
        <div class="api-section">
            <h3 class="section-title">分页查询用户</h3>
            <div class="card">
                <div class="card-header">
                    GET /api/users/page
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="pageNum">页码:</label>
                        <input type="number" class="form-control" id="pageNum" placeholder="输入页码" value="1">
                    </div>
                    <div class="form-group">
                        <label for="pageSize">每页条数:</label>
                        <input type="number" class="form-control" id="pageSize" placeholder="输入每页条数" value="10">
                    </div>
                    <button id="getUsersByPageBtn" class="btn btn-primary mb-3">分页查询</button>
                    <div class="result-area" id="usersByPageResult"></div>
                </div>
            </div>
        </div>

        <!-- 根据年龄范围查询 -->
        <div class="api-section">
            <h3 class="section-title">根据年龄范围查询用户</h3>
            <div class="card">
                <div class="card-header">
                    GET /api/users/age-range
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="minAge">最小年龄:</label>
                        <input type="number" class="form-control" id="minAge" placeholder="输入最小年龄">
                    </div>
                    <div class="form-group">
                        <label for="maxAge">最大年龄:</label>
                        <input type="number" class="form-control" id="maxAge" placeholder="输入最大年龄">
                    </div>
                    <button id="getUsersByAgeRangeBtn" class="btn btn-primary mb-3">按年龄查询</button>
                    <div class="result-area" id="usersByAgeRangeResult"></div>
                </div>
            </div>
        </div>

        <!-- 根据姓名模糊查询 -->
        <div class="api-section">
            <h3 class="section-title">根据姓名模糊查询用户</h3>
            <div class="card">
                <div class="card-header">
                    GET /api/users/search
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="searchName">姓名关键词:</label>
                        <input type="text" class="form-control" id="searchName" placeholder="输入姓名关键词">
                    </div>
                    <div class="form-group">
                        <label for="searchPage">页码:</label>
                        <input type="number" class="form-control" id="searchPage" placeholder="输入页码" value="1">
                    </div>
                    <div class="form-group">
                        <label for="searchSize">每页条数:</label>
                        <input type="number" class="form-control" id="searchSize" placeholder="输入每页条数" value="10">
                    </div>
                    <button id="searchUsersByNameBtn" class="btn btn-primary mb-3">搜索用户</button>
                    <div class="result-area" id="searchUsersByNameResult"></div>
                </div>
            </div>
        </div>

        <!-- 批量创建用户 -->
        <div class="api-section">
            <h3 class="section-title">批量创建用户</h3>
            <div class="card">
                <div class="card-header">
                    POST /api/users/batch
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="batchUsers">用户数据 (JSON格式):</label>
                        <textarea class="form-control" id="batchUsers" rows="5" placeholder='[
  {"name":"用户1", "age":25, "email":"user1@example.com"},
  {"name":"用户2", "age":30, "email":"user2@example.com"}
]'></textarea>
                    </div>
                    <button id="batchCreateUsersBtn" class="btn btn-primary mb-3">批量创建</button>
                    <div class="result-area" id="batchCreateUsersResult"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 设置基础URL
        const baseUrl = '/api/users';
        let userChart = null;

        // 初始化图表
        function initChart() {
            userChart = echarts.init(document.getElementById('userChart'));
            userChart.setOption({
                title: {
                    text: '用户年龄分布',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis'
                },
                xAxis: {
                    type: 'category',
                    data: ['18-25', '26-30', '31-40', '41-50', '50+']
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    data: [0, 0, 0, 0, 0],
                    type: 'bar',
                    itemStyle: {
                        color: '#007bff'
                    }
                }]
            });
        }

        // 更新数据概览
        function updateDashboard() {
            axios.get(baseUrl)
                .then(response => {
                    const users = response.data;
                    document.getElementById('totalUsers').innerText = users.length;
                    
                    if (users.length > 0) {
                        const avgAge = Math.round(users.reduce((sum, user) => sum + user.age, 0) / users.length);
                        document.getElementById('avgAge').innerText = avgAge;
                        
                        const activeUsers = users.filter(user => user.deleted === 0).length;
                        document.getElementById('activeUsers').innerText = activeUsers;
                        
                        const deletedUsers = users.filter(user => user.deleted === 1).length;
                        document.getElementById('deletedUsers').innerText = deletedUsers;
                        
                        // 更新图表数据
                        if (userChart) {
                            const ageGroups = [0, 0, 0, 0, 0];
                            users.forEach(user => {
                                if (user.age >= 18 && user.age <= 25) ageGroups[0]++;
                                else if (user.age >= 26 && user.age <= 30) ageGroups[1]++;
                                else if (user.age >= 31 && user.age <= 40) ageGroups[2]++;
                                else if (user.age >= 41 && user.age <= 50) ageGroups[3]++;
                                else if (user.age > 50) ageGroups[4]++;
                            });
                            
                            userChart.setOption({
                                series: [{
                                    data: ageGroups
                                }]
                            });
                        }
                    }
                })
                .catch(error => {
                    console.error('更新数据概览失败:', error);
                });
        }

        // 显示结果函数
        function showResult(elementId, data) {
            const resultElement = document.getElementById(elementId);
            if (typeof data === 'string') {
                resultElement.textContent = data;
            } else {
                resultElement.textContent = JSON.stringify(data, null, 2);
            }
        }

        // 绑定事件监听器
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化图表
            initChart();
            
            // 尝试更新数据概览
            updateDashboard();

            // 获取所有用户
            document.getElementById('getAllUsersBtn').addEventListener('click', function() {
                axios.get(baseUrl)
                    .then(response => showResult('allUsersResult', response.data))
                    .catch(error => showResult('allUsersResult', '请求失败: ' + error.message));
            });

            // 根据ID获取用户
            document.getElementById('getUserByIdBtn').addEventListener('click', function() {
                const userId = document.getElementById('userId').value;
                if (!userId) {
                    showResult('userByIdResult', '请输入用户ID');
                    return;
                }
                
                axios.get(`${baseUrl}/${userId}`)
                    .then(response => showResult('userByIdResult', response.data))
                    .catch(error => showResult('userByIdResult', '请求失败: ' + error.message));
            });

            // 创建新用户
            document.getElementById('createUserBtn').addEventListener('click', function() {
                const name = document.getElementById('createName').value;
                const age = document.getElementById('createAge').value;
                const email = document.getElementById('createEmail').value;
                
                if (!name || !age || !email) {
                    showResult('createUserResult', '请填写所有必填字段');
                    return;
                }
                
                const userData = {
                    name: name,
                    age: parseInt(age),
                    email: email
                };
                
                axios.post(baseUrl, userData)
                    .then(response => {
                        showResult('createUserResult', response.data ? '创建成功' : '创建失败');
                        updateDashboard();
                    })
                    .catch(error => showResult('createUserResult', '请求失败: ' + error.message));
            });

            // 更新用户信息
            document.getElementById('updateUserBtn').addEventListener('click', function() {
                const id = document.getElementById('updateId').value;
                const name = document.getElementById('updateName').value;
                const age = document.getElementById('updateAge').value;
                const email = document.getElementById('updateEmail').value;
                
                if (!id) {
                    showResult('updateUserResult', '请输入用户ID');
                    return;
                }
                
                const userData = {};
                if (name) userData.name = name;
                if (age) userData.age = parseInt(age);
                if (email) userData.email = email;
                
                axios.put(`${baseUrl}/${id}`, userData)
                    .then(response => {
                        showResult('updateUserResult', response.data ? '更新成功' : '更新失败');
                        updateDashboard();
                    })
                    .catch(error => showResult('updateUserResult', '请求失败: ' + error.message));
            });

            // 删除用户
            document.getElementById('deleteUserBtn').addEventListener('click', function() {
                const id = document.getElementById('deleteId').value;
                if (!id) {
                    showResult('deleteUserResult', '请输入用户ID');
                    return;
                }
                
                if (confirm(`确定要删除ID为${id}的用户吗？`)) {
                    axios.delete(`${baseUrl}/${id}`)
                        .then(response => {
                            showResult('deleteUserResult', response.data ? '删除成功' : '删除失败');
                            updateDashboard();
                        })
                        .catch(error => showResult('deleteUserResult', '请求失败: ' + error.message));
                }
            });

            // 分页查询用户
            document.getElementById('getUsersByPageBtn').addEventListener('click', function() {
                const pageNum = document.getElementById('pageNum').value || 1;
                const pageSize = document.getElementById('pageSize').value || 10;
                
                axios.get(`${baseUrl}/page`, {
                    params: {
                        page: pageNum,
                        size: pageSize
                    }
                })
                .then(response => showResult('usersByPageResult', response.data))
                .catch(error => showResult('usersByPageResult', '请求失败: ' + error.message));
            });

            // 根据年龄范围查询用户
            document.getElementById('getUsersByAgeRangeBtn').addEventListener('click', function() {
                const minAge = document.getElementById('minAge').value;
                const maxAge = document.getElementById('maxAge').value;
                
                if (!minAge || !maxAge) {
                    showResult('usersByAgeRangeResult', '请填写最小和最大年龄');
                    return;
                }
                
                axios.get(`${baseUrl}/age-range`, {
                    params: {
                        minAge: minAge,
                        maxAge: maxAge
                    }
                })
                .then(response => showResult('usersByAgeRangeResult', response.data))
                .catch(error => showResult('usersByAgeRangeResult', '请求失败: ' + error.message));
            });

            // 根据姓名模糊查询用户
            document.getElementById('searchUsersByNameBtn').addEventListener('click', function() {
                const name = document.getElementById('searchName').value;
                const page = document.getElementById('searchPage').value || 1;
                const size = document.getElementById('searchSize').value || 10;
                
                if (!name) {
                    showResult('searchUsersByNameResult', '请输入姓名关键词');
                    return;
                }
                
                axios.get(`${baseUrl}/search`, {
                    params: {
                        name: name,
                        page: page,
                        size: size
                    }
                })
                .then(response => showResult('searchUsersByNameResult', response.data))
                .catch(error => showResult('searchUsersByNameResult', '请求失败: ' + error.message));
            });

            // 批量创建用户
            document.getElementById('batchCreateUsersBtn').addEventListener('click', function() {
                const usersJson = document.getElementById('batchUsers').value;
                
                if (!usersJson) {
                    showResult('batchCreateUsersResult', '请输入用户数据');
                    return;
                }
                
                try {
                    const users = JSON.parse(usersJson);
                    
                    axios.post(`${baseUrl}/batch`, users)
                        .then(response => {
                            showResult('batchCreateUsersResult', response.data ? '批量创建成功' : '批量创建失败');
                            updateDashboard();
                        })
                        .catch(error => showResult('batchCreateUsersResult', '请求失败: ' + error.message));
                } catch (e) {
                    showResult('batchCreateUsersResult', 'JSON格式错误: ' + e.message);
                }
            });
        });
    </script>
</body>
</html>